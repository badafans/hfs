# 简易网页文件管理器

一个基于 Go 语言开发的轻量级网页文件管理器，提供直观的 Web 界面来管理服务器文件。支持文件上传、下载、创建、删除、重命名等基本操作，并具备用户认证和 HTTPS 安全传输功能。

## 功能特性

### 🔐 安全认证
- 基于 Token 的用户认证系统
- 支持"记住登录状态"功能（最长30天）
- 自动生成自签名 SSL 证书
- 支持自定义 SSL 证书
- 默认启用 HTTPS 安全传输

### 📁 文件管理
- **文件浏览**：支持目录导航和面包屑导航
- **文件上传**：支持多文件同时上传，带进度条显示
- **文件下载**：支持断点续传和多线程下载
- **文件操作**：创建、删除、重命名文件和文件夹
- **文件搜索**：实时搜索过滤文件列表
- **文件排序**：支持按名称、时间、大小排序（升序/降序）

### 🎨 用户界面
- 响应式设计，支持移动端访问
- 现代化的渐变色登录界面
- 直观的文件列表展示
- 右键菜单和触摸操作支持
- 模态对话框交互

### ⚡ 性能优化
- 内存管理优化（自动垃圾回收）
- 并发安全的文件操作
- 高效的文件大小计算
- 路径安全验证

## 快速开始

### 环境要求
- Go 1.16 或更高版本
- Linux/macOS/Windows 操作系统

### 编译运行

1. **编译程序**
   ```bash
   # 手动编译
   go build -o hfs main.go
   ```

2. **运行程序**
   ```bash
   # 基本运行（使用默认设置）
   ./hfs
   
   # 指定端口和目录
   ./hfs -port=8080 -dir=/path/to/files
   
   # 启用用户认证
   ./hfs -username=admin -password=secret
   
   # 使用自定义 SSL 证书
   ./hfs -cert=server.crt -key=server.key
   
   # 禁用 HTTPS（仅 HTTP）
   ./hfs -tls=false
   ```

3. **访问应用**
   - HTTPS: `https://localhost:8080`
   - HTTP: `http://localhost:8080`（需要 `-tls=false`）

## 命令行参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `-port` | 8080 | HTTP/HTTPS 服务器端口 |
| `-dir` | `.` | 文件管理的根目录 |
| `-username` | 空 | 登录用户名（可选） |
| `-password` | 空 | 登录密码（可选） |
| `-tls` | true | 是否启用 HTTPS |
| `-cert` | 空 | SSL 证书文件路径 |
| `-key` | 空 | SSL 私钥文件路径 |

### 使用示例

```bash
# 在 9000 端口启动，管理 /home/user/documents 目录
./hfs -port=9000 -dir=/home/user/documents

# 启用认证，用户名 admin，密码 123456
./hfs -username=admin -password=123456

# 使用自定义 SSL 证书
./hfs -cert=./ssl/server.crt -key=./ssl/server.key

# 仅使用 HTTP（不推荐用于生产环境）
./hfs -tls=false -port=8080
```

## API 接口

### 认证相关
- `GET /login` - 显示登录页面
- `POST /api/login` - 用户登录认证
- `GET /logout` - 用户登出

### 文件操作
- `GET /` - 主页面（文件列表）
- `GET /list` - 获取文件列表（AJAX）
- `POST /upload` - 上传文件
- `GET /download` - 下载文件
- `GET /delete` - 删除文件/文件夹
- `POST /create` - 创建文件/文件夹
- `POST /rename` - 重命名文件/文件夹

## 安全特性

### 路径安全
- 使用 `secureJoin` 函数防止路径遍历攻击
- 严格验证所有文件路径参数
- 限制访问范围在指定的根目录内

### 认证安全
- Token 基于 SHA256 哈希生成
- 支持 Token 过期时间设置
- HttpOnly Cookie 防止 XSS 攻击
- 自动清理过期 Token

### 传输安全
- 默认启用 HTTPS
- 自动生成自签名证书
- 支持自定义 SSL 证书
- TLS 1.2+ 加密传输

## 技术架构

### 核心技术
- **后端**：Go 标准库（net/http, html/template, crypto/tls 等）
- **前端**：原生 HTML5 + CSS3 + JavaScript
- **认证**：基于 Token 的无状态认证
- **安全**：TLS/SSL 加密，路径验证，XSS 防护

### 核心模块
- **认证模块**：用户登录、Token 管理、权限验证
- **文件模块**：文件上传、下载、CRUD 操作
- **模板模块**：HTML 模板渲染、页面生成
- **安全模块**：SSL 证书生成、路径验证

## 开发说明

### 代码结构
- 所有功能集成在单个 `main.go` 文件中
- 使用 Go 标准库，无外部依赖
- 模块化的函数设计，便于维护
- 完整的错误处理和日志记录

### 自定义开发
如需扩展功能，可以修改以下部分：
- **UI 样式**：修改 `loginTemplate` 和 `combinedTemplate` 中的 CSS
- **功能扩展**：添加新的 HTTP 处理函数
- **安全策略**：调整认证和授权逻辑
- **文件操作**：扩展文件处理功能

## 注意事项

### 生产环境部署
1. **使用正式 SSL 证书**：避免使用自签名证书
2. **设置强密码**：如果启用认证，请使用复杂密码
3. **限制访问权限**：合理设置文件目录权限
4. **定期更新**：保持程序版本更新
5. **监控日志**：关注访问日志和错误日志

### 安全建议
- 不要在公网直接暴露服务，建议使用反向代理
- 定期更换登录密码和 SSL 证书
- 限制上传文件类型和大小
- 定期备份重要文件

## 故障排除

### 常见问题

**Q: 无法访问 HTTPS 页面？**
A: 浏览器可能提示证书不安全，这是因为使用了自签名证书。点击"高级"→"继续访问"即可。

**Q: 文件上传失败？**
A: 检查目标目录权限，确保程序有写入权限。

**Q: 忘记登录密码？**
A: 重启程序并使用新的 `-username` 和 `-password` 参数。

**Q: 端口被占用？**
A: 使用 `-port` 参数指定其他端口，或停止占用该端口的其他程序。

## 许可证

本项目采用MIT开源许可证。